---
api_version: catalog/v1
type: Integration
metadata:
  namespace: "influxdb"
  name: "influxdb-metrics"
spec:
  class: supported
  provider: metrics
  display_name: InfluxDB Metrics
  short_description: Send metrics to an InfluxDB database
  tags:
    - influxdb
    - metrics
  contributors:
    - "@sensu"
  prompts:
    - type: section
      title: InfluxDB Metrics configuration

    - type: markdown
      body: |
        This integration requires configuration to connect to an InfluxDB database.

    - type: question
      name: influxdb_addr
      input:
        type: string
        required: true
        title: InfluxDB Address
        description: >-
          Some useful description of what to put in here
        default: ""

    - type: question
      name: influxdb_db
      input:
        type: string
        required: true
        title: InfluxDB Database
        description: >-
          Some useful description of what to put in here
        default: ""

    - type: question
      name: influxdb_user
      input:
        type: string
        required: true
        title: InfluxDB User
        description: >-
          Some useful description of what to put in here
        default: ""

    - type: question
      name: influxdb_password_secret_provider
      input:
        type: string
        title: InfluxDB Password
        description: >-
          Some useful description of what to put in here

  resource_patches:
    - resource:
        api_version: core/v2
        type: Handler
        name: influxdb
      patches:
        - path: /spec/env_vars/-
          op: add
          value: "INFLUXDB_ADDR=[[influxdb_addr]]"
        - path: /spec/env_vars/-
          op: add
          value: "INFLUXDB_DB=[[influxdb_db]]"
        - path: /spec/env_vars/-
          op: add
          value: "INFLUXDB_USER=[[influxdb_user]]"
        - path: /spec/env_vars/-
          op: add
          value: "INFLUXDB_PASSWORD=[[influxdb_password]]"
