---
api_version: catalog/v1
type: Integration
metadata:
  namespace: pushover
  name: pushover-alerts
spec:
  class: supported
  provider: alerts
  display_name: Pushover Alerts
  short_description: Integrates Sensu Integrations with Pushover Push Notifications
  supported_platforms:
    - linux
  tags:
    - pushover
    - incidents
    - alerts
  contributors:
    - "@sensu"
    - "@nixwiz"
    - "@jspaleta"
    - "@calebhailey"
  prompts:
    - type: section
      title: Pushover Application
    - type: markdown
      body: |
        This integration requires access to a Pushover Application User Key

        Either select an existing sensu secret value to use for the pushover
        integration user key, or provide the user key directly to be stored
        in an insecure manner embedded on the sensu check resource.
    - type: question
      name: pushover_user_key_secret
      input:
        type: string
        title: Pushover User Key Secret
        ref: secrets/v1/secret/metadata/name
    - type: question
      name: pushover_user_key_env
      input:
        type: string
        title: Pushover User Key Value
    - type: section
      title: Pushover Application
    - type: markdown
      body: |
        This integration requires access to a Pushover Application API Token

        Either select an existing sensu secret value to use for the pushover
        integration api token, or provide the token to directly to be stored
        in an insecure manner embedded on the sensu check resource.
    - type: question
      name: pushover_app_api_token_secret
      input:
        type: string
        title: Pushover Application API Token Secret
        ref: secrets/v1/secret/metadata/name
    - type: question
      name: pushover_app_api_token_env
      input:
        type: string
        title: Pushover Application API Token Value
  resource_patches:
    - resource:
        api_version: core/v2
        type: Handler
        name: pushover-alerts
      patches:
        - path: /spec/env_vars/-
          op: add
          value: "SENSU_PUSHOVER_USERKEY=[[pushover_user_key_env]]"
        - path: /spec/env_vars/-
          op: add
          value: "SENSU_PUSHOVER_TOKEN=[[pushover_app_api_token_env]]"
        - path: /spec/secrets/-
          op: add
          value:
            api_version: secrets/v1
            type: Secret
            name: pushover_user_key_secret
        - path: /spec/secrets/-
          op: add
          value:
            api_version: secrets/v1
            type: Secret
            name: pushover_app_api_token_secret
