## Overview

<!-- Sensu Integration description; supports markdown -->

The Ansible Tower Remediation integration enables Ansible Tower as an automated remediation provider for Sensu Go. Use this integration to configure remediation actions that trigger [Ansible Tower Job Templates][ansible-tower-job-templates].

<!-- Provide a high level overview of the integration contents (e.g. checks, filters, mutators, handlers, assets, etc) -->

This integration includes the following Sensu resources:

* `ansible-tower` ([pipeline])
* `ansible-tower` ([handler])
* `sensu/sensu-ansible-handler:2.1.0` ([asset])

## Dashboards

<!-- List of supported dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

The Ansible Tower Remediation integration is compatible with the [Jobs view][ansible-tower-jobs-dashboard] in the Ansible Tower User Interface. The Jobs Details pane will display Ansible Tower job status, started and finished times, job template details, and job output.

![](img/job-dashboard.png)

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. Get the Ansible Tower API host name or IP address.

1. Get an Ansible Tower application token:

   - Use the Ansible Tower User Interface to [create a new application][ansible-tower-application].

   - [Create and add an OAuth application token][ansible-tower-app-token] to your Ansible Tower user profile.

   **Optional**: If you want to use a Sensu [secret] to represent the Ansible Tower application token, you will need the secret name when you install this integration.

1. Add the remediation action [annotation] `io.sensu.ansible.config.actions` to one or more [checks].

   **Example**:

   ```yaml
   metadata:
     name: check_nginx
     labels: {}
     annotations:
       io.sensu.ansible.config.actions: |
         [
           {
             "template_name": "Start NGINX",
             "inventory_id": 2,
             "limit": "",
             "occurrences": [ 3 ],
             "severities": [ 1, 2 ]
           },
           {
             "template_id": 8,
             "inventory_name": "Web Servers",
             "limit": "",
             "occurrences": [ 10 ],
             "severities": [ 1, 2 ]
           }
         ]
   ```

1. Add the `ansible-tower` pipeline to the same [checks].
   
   **Example**:

  ```yaml
  spec:
    pipelines:
      - api_version: core/v2
        type: Pipeline
        name: ansible-tower
  ```

### Remediation action annotation

The following request attributes are available for the `io.sensu.ansible.config.actions` remediation action annotation:

Attribute      | Description
-------------- | -----------
inventory_id   | Ansible Tower inventory ID
inventory_name | Ansible Tower inventory name (use if inventory_id is not specified)
limit          | Ansible Tower inventory limit
occurrences    | Array of Sensu event `occurrences` values to match to trigger the Ansible Tower job
severities     | Array of Sensu event `status` values to match to trigger the Ansible Tower job
template_id    | Ansible Tower job template ID
template_name  | Ansible Tower job template name (use if template_id is not specified)

### Handler templating

The Ansible Tower Remediation integration supports [handler templating][handler-templating] for variable substitution with data from Sensu events.

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

The Ansible Tower Remediation integration uses the following Sensu [plugins]:

- [sensu/sensu-ansible-handler][sensu-ansible-handler-bonsai] ([GitHub][sensu-ansible-handler-github])

## Alerts

<!-- List of all alerts generated by this integration. -->

The Ansible Tower Remediation integration does not produce events that should be processed by an alert or incident management pipeline.

## Metrics

<!-- List of all metrics or events collected by this integration. -->

The Ansible Tower Remediation integration does not produce [metrics].

## Reference documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration; specifically including any third-party software documentation. -->

[Tower API Reference Guide][ansible-tower-api-reference] (Ansible Tower documentation)
[Job Templates][ansible-tower-job-templates] (Ansible Tower documentation)
[Token-Based Authentication][ansible-tower-auth-guide] (Ansible Tower documentation)


<!-- Links -->
[checks]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscriptions]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agents]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#general-configuration-flags
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[pipeline]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/pipelines/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[tokens]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[handler-templating]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handler-templates/
[sensu-plus]: https://sensu.io/features/analytics
[sensu-ansible-handler-bonsai]: https://bonsai.sensu.io/assets/sensu/sensu-ansible-handler
[sensu-ansible-handler-github]: https://github.com/sensu/sensu-ansible-handler
[ansible-tower-job-templates]: https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html
[ansible-tower-jobs-dashboard]: https://docs.ansible.com/ansible-tower/latest/html/userguide/jobs.html
[ansible-tower-application]: https://docs.ansible.com/ansible-tower/latest/html/userguide/applications_auth.html#create-a-new-application
[ansible-tower-app-token]: https://docs.ansible.com/ansible-tower/latest/html/userguide/applications_auth.html#add-tokens
[ansible-tower-api-reference]: https://docs.ansible.com/ansible-tower/latest/html/towerapi/api_ref.html
[ansible-tower-auth-guide]: https://docs.ansible.com/ansible-tower/latest/html/administration/oauth2_token_auth.html
[secret]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
